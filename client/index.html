<!DOCTYPE html>
<html class="dark" lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Legends of Learning - Multiplayer RPG</title>

  <!-- TAILWIND & FONTS -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
    rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&amp;display=swap"
    rel="stylesheet" />

  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#00ff55",
            "secondary": "#00d4ff",
            "accent": "#cc00ff",
            "background-light": "#f2f2f2",
            "background-dark": "#121216",
            "surface-dark": "#1a1a20",
          },
          fontFamily: {
            "display": ["Space Grotesk", "sans-serif"]
          },
        },
      },
    }
  </script>
  <style>
    body,
    * {
      cursor: url('/assets/cursor_03.png') 0 0, auto !important;
    }

    /* Phaser canvas cursor */
    canvas {
      cursor: url('/assets/cursor_03.png') 0 0, auto !important;
    }

    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #121216;
    }

    #app {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      z-index: 1;
    }

    /* Lobby Overlay Styles */
    #lobby-ui {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      z-index: 10;
      overflow-y: auto;
    }

    .hidden {
      display: none !important;
    }

    .pixel-border {
      box-shadow: 0 -4px 0 0 #000, 0 4px 0 0 #000, -4px 0 0 0 #000, 4px 0 0 0 #000;
    }

    .pixel-btn-green {
      box-shadow: inset -4px -4px 0px 0px #00a336;
    }

    .pixel-btn-blue {
      box-shadow: inset -4px -4px 0px 0px #008299;
    }

    .pixel-bg-pattern {
      background-image: radial-gradient(#202026 1px, transparent 1px);
      background-size: 20px 20px;
    }

    /* --- UI Layer (Controls) --- */
    #ui-layer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 50;
      /* Above game, below lobby (lobby z-index is likely high, checked lobby is 10/20?) */
    }

    /* --- WASD (Desktop) --- */
    #dpad-container {
      position: absolute;
      bottom: 30px;
      left: 30px;
      pointer-events: auto;
    }

    .dpad-row {
      display: flex;
      justify-content: center;
    }

    .dpad-btn {
      width: 60px;
      height: 60px;
      margin: 5px;
      background: rgba(0, 0, 0, 0.6);
      border: 4px solid #444;
      color: #999;
      /* Gray Text */
      font-family: 'Press Start 2P', monospace;
      font-size: 20px;
      cursor: pointer;
      border-radius: 8px;
      outline: none;
      touch-action: manipulation;
      user-select: none;
    }

    .dpad-btn:active,
    .dpad-btn.active {
      background: rgba(128, 128, 128, 0.5);
      /* Transparent Gray */
      color: #ccc;
      border-color: #888;
      transform: scale(0.95);
    }

    /* --- Joystick (Mobile) --- */
    #analog-container {
      position: absolute;
      bottom: 50px;
      left: 50px;
      width: 120px;
      height: 120px;
      pointer-events: auto;
      display: none;
    }

    #joystick-base {
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      border: 4px solid #444;
      border-radius: 16px;
      position: relative;
    }

    #joystick-stick {
      width: 50px;
      height: 50px;
      background: rgba(100, 100, 100, 0.9);
      border: 4px solid #888;
      border-radius: 12px;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      transition: transform 0.1s;
    }

    /* --- Responsive Switching --- */
    @media (max-width: 768px) {
      #dpad-container {
        display: none;
      }

      #analog-container {
        display: block;
      }
    }
  </style>
</head>

<body class="bg-background-light dark:bg-background-dark font-display text-white">

  <!-- PHASER CONTAINER -->
  <div id="app"></div>

  <!-- CONTROLS OVERLAY -->
  <div id="ui-layer" class="hidden">
    <!-- Virtual D-Pad (Desktop Visuals) -->
    <div id="dpad-container">
      <div class="dpad-row">
        <button id="btn-up" class="dpad-btn" data-key="W">W</button>
      </div>
      <div class="dpad-row">
        <button id="btn-left" class="dpad-btn" data-key="A">A</button>
        <button id="btn-down" class="dpad-btn" data-key="S">S</button>
        <button id="btn-right" class="dpad-btn" data-key="D">D</button>
      </div>
    </div>

    <!-- Analog Joystick (Mobile Control) -->
    <div id="analog-container">
      <div id="joystick-base">
        <div id="joystick-stick"></div>
      </div>
    </div>
  </div>

  <!-- LOBBY OVERLAY (Redesigned - No Scroll) -->
  <div id="lobby-ui" class="bg-background-dark fixed inset-0 z-10 overflow-hidden">
    <!-- Background Pattern -->
    <div class="absolute inset-0 pointer-events-none pixel-bg-pattern opacity-30"></div>

    <!-- Main Layout -->
    <div class="relative z-10 flex flex-col h-screen">
      <!-- Header -->
      <header class="flex items-center justify-between border-b-4 border-black bg-surface-dark px-6 py-3 shrink-0">
        <div class="flex items-center gap-3">
          <div class="size-7 bg-primary pixel-border flex items-center justify-center">
            <span class="material-symbols-outlined text-sm text-background-dark font-bold">videogame_asset</span>
          </div>
          <h2 class="text-lg font-bold tracking-tighter uppercase">Pixel Lobby <span class="text-primary">v2.0</span>
          </h2>
        </div>
      </header>

      <!-- Content: Side by Side -->
      <main class="flex-1 flex flex-row">
        <!-- Left: Host Session -->
        <section class="flex-1 flex flex-col items-center justify-center p-6 border-r-4 border-black">
          <div class="flex flex-col items-center text-center space-y-5">
            <div class="w-24 h-24 bg-primary/10 border-4 border-primary flex items-center justify-center">
              <span class="material-symbols-outlined text-5xl text-primary">add_box</span>
            </div>
            <div>
              <h1 class="text-2xl font-bold tracking-tighter uppercase italic">Host Session</h1>
              <p class="text-primary/60 text-sm font-medium mt-1">Create a new game room</p>
            </div>
            <button id="create-room-btn"
              class="w-48 h-12 bg-primary text-background-dark font-bold uppercase pixel-btn-green border-4 border-black active:translate-y-1 transition-transform">
              Create Room
            </button>
          </div>
        </section>

        <!-- Right: Join Session -->
        <section class="flex-1 flex flex-col items-center justify-center p-6 bg-surface-dark/30">
          <div class="flex flex-col items-center text-center space-y-5">
            <div class="w-24 h-24 bg-secondary/10 border-4 border-secondary flex items-center justify-center">
              <span class="material-symbols-outlined text-5xl text-secondary">login</span>
            </div>
            <div>
              <h1 class="text-2xl font-bold tracking-tighter uppercase italic">Join Session</h1>
              <p class="text-secondary/60 text-sm font-medium mt-1">Enter room access code</p>
            </div>
            <div class="w-64 space-y-3">
              <div class="relative">
                <input id="room-code-input"
                  class="w-full h-14 bg-black/40 border-4 border-white/10 focus:border-secondary focus:ring-0 text-center text-2xl font-bold tracking-[0.3em] text-secondary uppercase placeholder:text-white/10"
                  placeholder="000000" type="text" maxlength="6" />
              </div>
              <button id="join-room-btn"
                class="w-full h-12 bg-secondary text-background-dark font-bold uppercase pixel-btn-blue border-4 border-black active:translate-y-1 transition-transform">
                Join Game
              </button>
            </div>
          </div>
        </section>
      </main>

      <!-- Footer -->
      <footer
        class="bg-black py-2 px-6 flex justify-center items-center text-[9px] font-bold uppercase tracking-widest text-white/30 shrink-0">
        <span>Â© 2025 Legends of Learning</span>
      </footer>
    </div>
  </div>
  </div>

  <!-- CREATE ROOM UI (Difficulty + Subject Selection) -->
  <div id="create-room-ui" class="bg-background-dark hidden fixed top-0 left-0 w-full h-screen z-20">
    <div class="fixed inset-0 pointer-events-none overflow-hidden pixel-bg-pattern"></div>

    <div class="relative z-10 flex h-screen w-full flex-col items-center justify-center p-8">
      <!-- Back Button -->
      <button id="back-to-lobby-btn"
        class="absolute top-4 left-4 flex items-center gap-2 text-white/60 hover:text-primary transition-colors">
        <span class="material-symbols-outlined">arrow_back</span>
        <span class="text-xs font-bold uppercase">Back</span>
      </button>

      <h1 class="text-3xl font-bold tracking-tighter uppercase italic text-white mb-8">Create New Room</h1>

      <div class="w-full max-w-md bg-surface-dark p-8 border-4 border-black space-y-6">
        <!-- Difficulty Selection -->
        <div class="space-y-3">
          <p class="text-xs font-bold uppercase text-white/40 tracking-widest">Select Difficulty</p>
          <div class="grid grid-cols-3 gap-2">
            <button
              class="difficulty-btn bg-black/40 border-2 border-white/10 p-3 text-center hover:border-primary transition-colors"
              data-difficulty="mudah">
              <span class="text-lg font-bold text-primary">Mudah</span>
              <p class="text-[9px] text-white/40">4 Players</p>
            </button>
            <button
              class="difficulty-btn bg-black/40 border-2 border-white/10 p-3 text-center hover:border-primary transition-colors"
              data-difficulty="sedang">
              <span class="text-lg font-bold text-secondary">Sedang</span>
              <p class="text-[9px] text-white/40">5 Players</p>
            </button>
            <button
              class="difficulty-btn bg-black/40 border-2 border-white/10 p-3 text-center hover:border-primary transition-colors"
              data-difficulty="sulit">
              <span class="text-lg font-bold text-accent">Sulit</span>
              <p class="text-[9px] text-white/40">6 Players</p>
            </button>
          </div>
        </div>

        <!-- Subject Selection -->
        <div class="space-y-3">
          <p class="text-xs font-bold uppercase text-white/40 tracking-widest">Select Subject</p>
          <select id="subject-select"
            class="w-full h-12 bg-black/40 border-2 border-white/10 focus:border-primary focus:ring-0 px-3 text-primary font-bold uppercase text-sm">
            <option value="matematika">Matematika</option>
            <option value="biologi">Biologi</option>
            <option value="sejarah">Sejarah</option>
            <option value="fisika">Fisika</option>
            <option value="kimia">Kimia</option>
            <option value="geografi">Geografi</option>
          </select>
        </div>

        <!-- Create Button -->
        <button id="confirm-create-room-btn"
          class="w-full h-16 bg-primary text-background-dark font-bold text-xl uppercase pixel-btn-green border-4 border-black active:translate-y-1 transition-transform">
          Buat Room
        </button>
      </div>
    </div>
  </div>

  <!-- WAITING ROOM OVERLAY (New Design) -->
  <div id="waiting-ui" class="bg-background-dark hidden fixed top-0 left-0 w-full h-screen z-20 overflow-hidden">
    <div class="fixed inset-0 pointer-events-none overflow-hidden pixel-bg-pattern"></div>

    <div class="relative z-10 flex h-screen w-full flex-col">
      <!-- Header -->
      <header class="flex items-center justify-between border-b-4 border-black bg-surface-dark px-6 py-3 shrink-0">
        <div class="flex items-center gap-3">
          <div class="size-7 bg-primary pixel-border flex items-center justify-center">
            <span class="material-symbols-outlined text-sm text-background-dark font-bold">videogame_asset</span>
          </div>
          <h2 class="text-lg font-bold tracking-tighter uppercase">Waiting Room</h2>
        </div>
        <div class="text-center">
          <p class="text-[9px] font-bold text-white/40 uppercase tracking-widest">Room Code</p>
          <div id="display-room-code" class="text-3xl font-bold tracking-[0.15em] text-accent">------</div>
        </div>
        <div class="w-24"></div>
      </header>

      <!-- Main Content -->
      <main class="flex-1 flex p-4 gap-4 overflow-hidden">
        <!-- Left: Character + Name -->
        <section class="w-64 shrink-0 flex flex-col gap-3">
          <div class="bg-surface-dark border-4 border-black p-4 flex-1">
            <p class="text-[9px] font-bold text-white/40 uppercase tracking-widest mb-3">Select Character</p>
            <div class="flex items-center justify-between bg-black/40 border-2 border-white/10 p-3">
              <button class="hover:text-primary transition-colors">
                <span class="material-symbols-outlined text-2xl">chevron_left</span>
              </button>
              <div class="w-16 h-16 bg-white/5 border-2 border-white/10 flex items-center justify-center">
                <span class="material-symbols-outlined text-4xl text-primary">face</span>
              </div>
              <button class="hover:text-primary transition-colors">
                <span class="material-symbols-outlined text-2xl">chevron_right</span>
              </button>
            </div>
            <p class="text-[9px] font-bold text-white/40 uppercase tracking-widest mt-4 mb-2">Your Name</p>
            <input id="player-name-input"
              class="w-full h-10 bg-black/40 border-2 border-white/10 focus:border-primary focus:ring-0 px-3 font-bold tracking-wider uppercase text-primary text-sm placeholder:text-white/20"
              placeholder="Enter Name" type="text" maxlength="20" value="Player 1" />
          </div>
        </section>

        <!-- Center: Connected Players (Grid) -->
        <section class="flex-1 flex flex-col gap-3 overflow-hidden">
          <div class="bg-surface-dark border-4 border-black p-4 flex-1 flex flex-col">
            <div class="flex justify-between items-center mb-3">
              <p class="text-[9px] font-bold text-white/40 uppercase tracking-widest">Connected Players</p>
              <p id="player-count" class="text-[9px] font-bold text-primary uppercase">(0/4)</p>
            </div>
            <div id="player-grid" class="grid grid-cols-2 md:grid-cols-4 gap-2 flex-1 overflow-y-auto custom-scrollbar">
              <!-- Player cards will be injected here -->
            </div>
          </div>
          <button id="start-game-btn"
            class="w-full h-14 bg-primary text-background-dark font-bold text-lg uppercase pixel-btn-green border-4 border-black active:translate-y-1 transition-transform shrink-0 hidden">
            Start Game
          </button>
          <div id="waiting-msg" class="text-center text-white/50 text-xs uppercase shrink-0">Waiting for host to
            start...</div>
        </section>

        <!-- Right: Chat -->
        <!-- Right: Room Selector -->
        <section class="w-72 shrink-0 flex flex-col">
          <div class="bg-surface-dark border-4 border-black p-3 flex-1 flex flex-col">
            <div class="flex items-center gap-2 mb-3 border-b-2 border-white/10 pb-2">
              <span class="material-symbols-outlined text-secondary text-sm">meeting_room</span>
              <h3 class="text-[9px] font-bold uppercase tracking-widest">Select Room</h3>
            </div>
            <div id="room-list" class="flex-1 overflow-y-auto custom-scrollbar space-y-2 mb-3 pr-1">
              <!-- Room cards will be injected here -->
            </div>
            <div class="mt-auto pt-2 border-t-2 border-white/10 text-center">
              <p class="text-[9px] text-white/40 uppercase">Click a room to switch</p>
            </div>
          </div>
        </section>
      </main>

      <!-- Footer -->
      <footer
        class="bg-black py-2 px-6 flex justify-between items-center text-[9px] font-bold uppercase tracking-widest text-white/40 shrink-0">
        <span class="flex items-center gap-2">
          <div class="w-2 h-2 bg-primary"></div> Status: Connected
        </span>
        <span id="host-indicator" class="text-primary/60">You are: Guest</span>
      </footer>
    </div>
  </div>

  <!-- MAIN SCRIPT -->
  <script type="module" src="/src/main.ts"></script>
</body>

</html>