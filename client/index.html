<!DOCTYPE html>
<html class="dark" lang="en">

<head>
  <meta charset="UTF-8" />

  <!-- QUIZ SELECTION styles -->
  <style>
    .card-hover:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px -10px rgba(0, 0, 0, 0.5);
      border-color: #00ff55;
    }

    .custom-scrollbar::-webkit-scrollbar {
      width: 8px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
      background: #1a1a20;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #333;
      border-radius: 4px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: #00ff55;
    }

    /* Dropdown Options Fix for Dark Mode */
    #quiz-category-select option {
      background-color: #1a1a20;
      color: white;
    }
  </style>
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Legends of Learning - Multiplayer RPG</title>

  <!-- TAILWIND & FONTS -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
    rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&amp;display=swap"
    rel="stylesheet" />

  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#00ff55",
            "secondary": "#00d4ff",
            "accent": "#cc00ff",
            "background-light": "#f2f2f2",
            "background-dark": "#121216",
            "surface-dark": "#1a1a20",
          },
          fontFamily: {
            "display": ["Space Grotesk", "sans-serif"]
          },
        },
      },
    }
  </script>
  <style>
    body,
    * {
      cursor: url('/assets/cursor_03.png') 0 0, auto !important;
    }

    /* Phaser canvas cursor */
    canvas {
      cursor: url('/assets/cursor_03.png') 0 0, auto !important;
    }

    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #121216;
    }

    #app {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      z-index: 1;
    }

    /* Lobby Overlay Styles */
    #lobby-ui {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      z-index: 10;
      overflow-y: auto;
    }

    .hidden {
      display: none !important;
    }

    .pixel-border {
      box-shadow: 0 -4px 0 0 #000, 0 4px 0 0 #000, -4px 0 0 0 #000, 4px 0 0 0 #000;
    }

    .pixel-btn-green {
      box-shadow: inset -4px -4px 0px 0px #00a336;
    }

    .pixel-btn-blue {
      box-shadow: inset -4px -4px 0px 0px #008299;
    }

    /* Animated Scrolling Background (Bottom-Left Direction) */
    @keyframes scroll-diagonal {
      0% {
        background-position: 0 0;
      }

      100% {
        background-position: -400px 400px;
        /* Move LEFT (-x) and DOWN (+y) */
      }
    }

    .pixel-bg-pattern {
      background-image: url('/assets/bg_pattern.png');
      background-repeat: repeat;
      background-size: 400px;
      /* Made MUCH larger */
      animation: scroll-diagonal 20s linear infinite;
      /* Slower animation for larger pattern */
      image-rendering: pixelated;
      /* Ensure crisp scaling */
    }

    /* --- UI Layer (Controls) --- */
    #ui-layer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 50;
      /* Above game, below lobby (lobby z-index is likely high, checked lobby is 10/20?) */
    }

    /* --- WASD (Desktop) --- */
    #dpad-container {
      position: absolute;
      bottom: 30px;
      left: 30px;
      pointer-events: auto;
    }

    .dpad-row {
      display: flex;
      justify-content: center;
    }

    .dpad-btn {
      width: 60px;
      height: 60px;
      margin: 5px;
      background: rgba(0, 0, 0, 0.6);
      border: 4px solid #444;
      color: #999;
      /* Gray Text */
      font-family: 'Press Start 2P', monospace;
      font-size: 20px;
      cursor: pointer;
      border-radius: 8px;
      outline: none;
      touch-action: manipulation;
      user-select: none;
    }

    .dpad-btn:active,
    .dpad-btn.active {
      background: rgba(128, 128, 128, 0.5);
      /* Transparent Gray */
      color: #ccc;
      border-color: #888;
      transform: scale(0.95);
    }

    /* --- Joystick (Mobile) --- */
    #analog-container {
      position: absolute;
      bottom: 50px;
      left: 50px;
      width: 120px;
      height: 120px;
      pointer-events: auto;
      display: none;
    }

    #joystick-base {
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      border: 4px solid #444;
      border-radius: 16px;
      position: relative;
    }

    #joystick-stick {
      width: 50px;
      height: 50px;
      background: rgba(100, 100, 100, 0.9);
      border: 4px solid #888;
      border-radius: 12px;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      transition: transform 0.1s;
    }

    /* --- Responsive Switching --- */
    @media (max-width: 768px) {
      #dpad-container {
        display: none;
      }

      #analog-container {
        display: block;
      }
    }

    /* Floating Animation for Host Icon */
    @keyframes float {

      0%,
      100% {
        transform: translateY(0);
      }

      50% {
        transform: translateY(-10px);
      }
    }

    .animate-float {
      animation: float 3s ease-in-out infinite;
    }

    /* SPRITE ANIMATION (6 Frames: 1, 6, 7, 8, 9, 10 from original) */
    /* New icons: 144x24 sprite sheets (6 frames at 24x24 each) */
    /* Scaled up to 128x128 display size (768x128 total) */
    @keyframes sprite-play-6 {
      from {
        background-position: 0 0;
      }

      to {
        background-position: -768px 0;
      }
    }

    .sprite-icon {
      width: 128px;
      height: 128px;
      background-repeat: no-repeat;
      /* Scale 144x24 -> 768x128 (128/24 = 5.33x) */
      background-size: 768px 128px;
      image-rendering: pixelated;
    }

    .icon-sword {
      background-image: url('/assets/icon_sword_subset.png');
      animation: sprite-play-6 0.6s steps(6) infinite;
    }

    .icon-shield {
      background-image: url('/assets/icon_evasion_subset.png');
      animation: sprite-play-6 0.6s steps(6) infinite;
    }

    /* --- Button Sweep/Fill Animation --- */
    .btn-sweep {
      position: relative;
      overflow: hidden;
      z-index: 1;
      transition: color 0.3s;
    }

    .btn-sweep::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 0%;
      height: 100%;
      background-color: white;
      /* Fill color */
      z-index: -1;
      transition: width 0.3s ease-in-out;
    }

    /* Specific text colors for hover state if needed */
    .pixel-btn-green.btn-sweep:hover {
      color: #000 !important;
    }

    .pixel-btn-blue.btn-sweep:hover {
      color: #000 !important;
    }

    .btn-sweep:hover::before {
      width: 100%;
    }

    /* --- Spotlight / Dimming Effect --- */
    /* When hovering the main container, dim all sections by default */
    .lobby-container:hover .lobby-card {
      filter: grayscale(80%) brightness(0.5);
      transform: scale(0.95);
      transition: all 0.4s ease;
    }

    /* But keep the specifically hovered card bright and scaled up */
    /* But keep the specifically hovered card bright and scaled up */
    .lobby-container .lobby-card:hover {
      filter: grayscale(0%) brightness(1.1);
      transform: scale(1.05);
      z-index: 10;
      box-shadow: 0 0 50px rgba(0, 0, 0, 0.8);
    }

    /* Icon Specific Glows on Card Hover */
    .lobby-container .lobby-card:hover .icon-sword {
      filter: drop-shadow(0 0 20px #00ff55);
    }

    .lobby-container .lobby-card:hover .icon-shield {
      filter: drop-shadow(0 0 20px #ffffff);
      /* White Glow for Shield */
    }

    /* --- GLOBAL IRIS TRANSITION (Robust Box-Shadow Method) --- */
    #transition-overlay {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 2147483647 !important;

      /* Base State: Tiny hole, No Shadow (Hidden) */
      width: 0;
      height: 0;
      border-radius: 50%;
      background: transparent;
      box-shadow: 0 0 0 0 transparent;
      pointer-events: none;
    }

    /* 1. PERSISTENT STATE: Shadow is ON (Black) */
    /* This class is added first and removed last to prevent flickering */
    #transition-overlay.overlay-active {
      box-shadow: 0 0 0 300vmax black;
      pointer-events: auto;
    }

    /* 2. ANIMATIONS: Only control width/height of the "Hole" */

    /* Close: Big Hole -> Small Hole (Screen goes black) */
    .iris-close {
      animation: anim-close 0.6s cubic-bezier(0.25, 1, 0.5, 1) forwards;
    }

    /* Open: Small Hole -> Big Hole (Screen reveals) */
    .iris-open {
      animation: anim-open 0.8s cubic-bezier(0.25, 1, 0.5, 1) forwards;
    }

    @keyframes anim-close {
      0% {
        width: 300vmax;
        height: 300vmax;
      }

      100% {
        width: 0px;
        height: 0px;
      }
    }

    @keyframes anim-open {
      0% {
        width: 0px;
        height: 0px;
      }

      100% {
        width: 300vmax;
        height: 300vmax;
      }
    }
  </style>
</head>

<body class="bg-background-light dark:bg-background-dark font-display text-white">

  <!-- PHASER CONTAINER -->
  <div id="app"></div>

  <!-- CONTROLS OVERLAY -->
  <div id="ui-layer" class="hidden">
    <!-- Virtual D-Pad (Desktop Visuals) -->
    <div id="dpad-container">
      <div class="dpad-row">
        <button id="btn-up" class="dpad-btn" data-key="W">W</button>
      </div>
      <div class="dpad-row">
        <button id="btn-left" class="dpad-btn" data-key="A">A</button>
        <button id="btn-down" class="dpad-btn" data-key="S">S</button>
        <button id="btn-right" class="dpad-btn" data-key="D">D</button>
      </div>
    </div>

    <!-- Analog Joystick (Mobile Control) -->
    <div id="analog-container">
      <div id="joystick-base">
        <div id="joystick-stick"></div>
      </div>
    </div>
  </div>

  <!-- LOBBY OVERLAY (Redesigned - No Scroll) -->
  <div id="lobby-ui" class="bg-background-dark fixed inset-0 z-10 overflow-hidden">
    <!-- Background Pattern -->
    <div class="absolute inset-0 pointer-events-none pixel-bg-pattern opacity-15"></div>

    <!-- Main Layout -->
    <div class="relative z-10 flex flex-col h-screen">
      <!-- Header Removed for Clean Look -->
      <!-- <header class="flex items-center justify-between border-b-4 border-black bg-surface-dark px-6 py-3 shrink-0"> ... </header> -->

      <!-- Content: Side by Side -->
      <main class="flex-1 flex flex-row lobby-container group/main">
        <!-- Left: Host Session -->
        <section class="flex-1 flex flex-col items-center justify-center p-6 lobby-card transition-all duration-300">
          <div class="flex flex-col items-center text-center space-y-6">
            <!-- Sword Icon (Sprite) -->
            <div class="relative">
              <div class="sprite-icon icon-sword"></div>
              <!-- Glow effect behind (Removed internal logic, handled by card hover now) -->
            </div>

            <div>
              <h1
                class="text-3xl font-bold tracking-widest uppercase text-primary font-['Press_Start_2P'] drop-shadow-[4px_4px_0_rgba(0,0,0,1)]">
                Host Session
              </h1>
              <p class="text-white/60 text-xs font-bold uppercase mt-4 font-['Press_Start_2P'] tracking-wide">
                Create a new game room
              </p>
            </div>

            <button id="create-room-btn"
              class="px-8 py-4 bg-primary text-background-dark font-bold text-sm uppercase pixel-btn-green border-4 border-black active:translate-y-1 btn-sweep font-['Press_Start_2P']">
              Create Room
            </button>
          </div>
        </section>

        <!-- Right: Join Session -->
        <section class="flex-1 flex flex-col items-center justify-center p-6 lobby-card transition-all duration-300">
          <div class="flex flex-col items-center text-center space-y-6">
            <!-- Shield/Evasion Icon (Sprite) -->
            <div class="relative">
              <div class="sprite-icon icon-shield"></div>
            </div>

            <div>
              <h1
                class="text-3xl font-bold tracking-widest uppercase text-secondary font-['Press_Start_2P'] drop-shadow-[4px_4px_0_rgba(0,0,0,1)]">
                Join Session
              </h1>
              <p class="text-white/60 text-xs font-bold uppercase mt-4 font-['Press_Start_2P'] tracking-wide">
                Enter room access code
              </p>
            </div>

            <div class="w-80 space-y-4">
              <div class="relative">
                <input id="room-code-input"
                  class="w-full h-16 bg-black/60 border-4 border-white/10 focus:border-secondary focus:ring-0 text-center text-2xl tracking-[0.2em] text-secondary uppercase placeholder:text-white/10 font-['Press_Start_2P']"
                  placeholder="000000" type="text" maxlength="6" />
              </div>
              <button id="join-room-btn"
                class="w-full h-14 bg-secondary text-background-dark font-bold text-sm uppercase pixel-btn-blue border-4 border-black active:translate-y-1 btn-sweep font-['Press_Start_2P']">
                Join Game
              </button>
            </div>
          </div>
        </section>
      </main>

      <!-- Footer -->
      <footer
        class="bg-black py-2 px-6 flex justify-center items-center text-[9px] font-bold uppercase tracking-widest text-white/30 shrink-0">
        <span>Â© 2026 gameforsmart</span>
      </footer>
    </div>
  </div>
  </div>

  <!-- CREATE ROOM UI (Difficulty + Subject Selection) -->
  <div id="create-room-ui" class="bg-background-dark hidden fixed top-0 left-0 w-full h-screen z-20">
    <div class="fixed inset-0 pointer-events-none overflow-hidden pixel-bg-pattern opacity-15"></div>

    <div class="relative z-10 flex h-screen w-full flex-col items-center justify-center p-8">
      <!-- Back Button -->
      <button id="back-to-lobby-btn"
        class="absolute top-4 left-4 flex items-center gap-2 text-white/60 hover:text-primary transition-colors">
        <span class="material-symbols-outlined">arrow_back</span>
        <span class="text-xs font-bold uppercase">Back</span>
      </button>

      <h1 class="text-3xl font-bold tracking-tighter uppercase italic text-white mb-8">Create New Room</h1>

      <div class="w-full max-w-md bg-surface-dark p-8 border-4 border-black space-y-6">
        <!-- Difficulty Selection -->
        <div class="space-y-3">
          <p class="text-xs font-bold uppercase text-white/40 tracking-widest">Select Difficulty</p>
          <div class="grid grid-cols-3 gap-2">
            <button
              class="difficulty-btn bg-black/40 border-2 border-white/10 p-3 text-center hover:border-primary transition-colors"
              data-difficulty="mudah">
              <span class="text-lg font-bold text-primary">Mudah</span>
              <p class="text-[9px] text-white/40">4 Players</p>
            </button>
            <button
              class="difficulty-btn bg-black/40 border-2 border-white/10 p-3 text-center hover:border-primary transition-colors"
              data-difficulty="sedang">
              <span class="text-lg font-bold text-secondary">Sedang</span>
              <p class="text-[9px] text-white/40">5 Players</p>
            </button>
            <button
              class="difficulty-btn bg-black/40 border-2 border-white/10 p-3 text-center hover:border-primary transition-colors"
              data-difficulty="sulit">
              <span class="text-lg font-bold text-accent">Sulit</span>
              <p class="text-[9px] text-white/40">6 Players</p>
            </button>
          </div>
        </div>

        <!-- Subject Selection -->
        <div class="space-y-3">
          <p class="text-xs font-bold uppercase text-white/40 tracking-widest">Select Subject</p>
          <select id="subject-select"
            class="w-full h-12 bg-black/40 border-2 border-white/10 focus:border-primary focus:ring-0 px-3 text-primary font-bold uppercase text-sm">
            <option value="matematika">Matematika</option>
            <option value="biologi">Biologi</option>
            <option value="sejarah">Sejarah</option>
            <option value="fisika">Fisika</option>
            <option value="kimia">Kimia</option>
            <option value="geografi">Geografi</option>
          </select>
        </div>

        <!-- Create Button -->
        <button id="confirm-create-room-btn"
          class="w-full h-16 bg-primary text-background-dark font-bold text-xl uppercase pixel-btn-green border-4 border-black active:translate-y-1 transition-transform">
          Buat Room
        </button>
      </div>
    </div>
  </div>

  <!-- QUIZ SELECTION UI -->
  <div id="quiz-selection-ui"
    class="bg-background-dark hidden fixed top-0 left-0 w-full h-screen z-20 overflow-hidden font-display">
    <div class="fixed inset-0 pointer-events-none overflow-hidden pixel-bg-pattern opacity-15"></div>

    <!-- Navbar/Header (Redesigned) -->
    <nav class="relative z-10 p-6 flex justify-between items-center shrink-0">
      <!-- Left: Back Button Only -->
      <button id="quiz-back-btn" class="flex items-center gap-3 text-white/50 hover:text-white transition-colors group">
        <div
          class="w-10 h-10 rounded-full border-2 border-white/10 flex items-center justify-center group-hover:border-primary group-hover:bg-primary group-hover:text-black transition-all">
          <span class="material-symbols-outlined">arrow_back</span>
        </div>
        <span class="text-xs font-bold uppercase tracking-widest hidden md:block">Back</span>
      </button>

      <!-- Right: Empty (Icons moved to filter bar) -->
      <div></div>
    </nav>

    <!-- Main Content -->
    <main class="relative z-10 max-w-5xl mx-auto px-4 h-[calc(100vh-100px)] flex flex-col">

      <!-- Unified Search & Filter Bar (Reference Image Style) -->
      <div class="w-full mb-8 shrink-0 relative z-50">
        <!-- Container with Neon Border -->
        <div
          class="flex flex-col md:flex-row items-stretch md:items-center bg-black/60 border-2 border-primary/30 rounded-2xl p-2 gap-2 shadow-[0_0_15px_rgba(0,255,85,0.1)] backdrop-blur-sm">

          <!-- Search Section (Grow) -->
          <div class="relative flex-grow flex items-center">
            <input id="quiz-search-input"
              class="w-full h-12 pl-4 pr-12 bg-transparent border-none focus:ring-0 text-white placeholder:text-white/30 font-medium text-sm font-['Press_Start_2P'] tracking-tight"
              placeholder="SEARCH QUIZ..." type="text" />

            <!-- Search Icon (Right side of input) -->
            <button id="search-trigger-btn"
              class="absolute right-4 text-primary hover:text-white transition-colors cursor-pointer p-1">
              <span class="material-symbols-outlined font-bold">search</span>
            </button>

            <!-- Vertical Divider -->
            <div class="absolute right-0 top-2 bottom-2 w-0.5 bg-white/10 hidden md:block"></div>
          </div>

          <!-- Middle: Custom Dropdown -->
          <div
            class="relative min-w-[200px] shrink-0 border-t md:border-t-0 border-white/10 md:border-l md:border-white/10 z-50">
            <!-- Trigger Button -->
            <button id="custom-cat-trigger"
              class="w-full h-12 flex items-center justify-between pl-4 pr-3 text-white text-xs font-bold uppercase cursor-pointer font-['Press_Start_2P'] tracking-tight hover:text-primary transition-colors focus:outline-none group">
              <span id="custom-cat-selected" class="truncate mr-2">ALL</span>
              <span id="custom-cat-arrow"
                class="material-symbols-outlined text-sm text-primary transition-transform duration-300 group-hover:scale-110">expand_more</span>
            </button>

            <!-- Custom Dropdown Menu (Hidden by default) -->
            <div id="custom-cat-menu"
              class="hidden absolute top-[calc(100%+8px)] left-0 w-full bg-[#1a1a20] border-2 border-primary/30 rounded-xl shadow-[0_0_30px_rgba(0,255,85,0.2)] overflow-hidden origin-top transform transition-all duration-200 scale-95 opacity-0 flex flex-col p-1">
              <!-- Options injected via JS -->
            </div>

            <!-- Hidden Native Select (For Logic Compatibility) -->
            <select id="quiz-category-select" class="hidden"></select>
          </div>

          <!-- Right: Icons (Fav & Profile) -->
          <div
            class="flex items-center gap-2 pl-2 border-t md:border-t-0 border-white/10 md:border-l md:border-white/10 py-2 md:py-0 justify-end px-2">
            <!-- Favorites Toggle -->
            <button id="quiz-filter-fav-btn"
              class="w-10 h-10 rounded-xl border border-white/10 hover:border-red-500 hover:bg-red-500/10 flex items-center justify-center transition-all group"
              title="Favorites">
              <span
                class="material-symbols-outlined text-white/40 group-hover:text-red-500 fill-current text-lg">favorite</span>
            </button>

            <!-- My Quiz / Profile Icon -->
            <button
              class="w-10 h-10 rounded-xl border border-white/10 hover:border-primary hover:bg-primary/10 flex items-center justify-center transition-all group"
              title="My Quiz">
              <span class="material-symbols-outlined text-white/40 group-hover:text-primary text-lg">person</span>
            </button>
          </div>

        </div>
      </div>

      <!-- Quiz Grid -->
      <div id="quiz-grid"
        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 overflow-y-auto custom-scrollbar pr-2 pb-20">
        <!-- Cards injected via JS -->
      </div>

      <!-- Pagination -->
      <div class="mt-auto pt-4 flex justify-center items-center gap-4 shrink-0 border-t-2 border-white/5">
        <button id="prev-page-btn"
          class="px-4 py-2 bg-black/40 border-2 border-white/10 hover:border-white/40 text-white/60 hover:text-white flex items-center gap-2 transition-colors disabled:opacity-30 disabled:cursor-not-allowed">
          <span class="material-symbols-outlined text-sm">chevron_left</span>
          <span class="text-xs font-bold uppercase">Prev</span>
        </button>

        <div id="pagination-numbers" class="flex items-center gap-2">
          <!-- Page numbers injected -->
        </div>

        <button id="next-page-btn"
          class="px-4 py-2 bg-black/40 border-2 border-white/10 hover:border-white/40 text-white/60 hover:text-white flex items-center gap-2 transition-colors disabled:opacity-30 disabled:cursor-not-allowed">
          <span class="text-xs font-bold uppercase">Next</span>
          <span class="material-symbols-outlined text-sm">chevron_right</span>
        </button>
      </div>
    </main>
  </div>

  <!-- QUIZ SETTINGS UI (Configuration) -->
  <div id="quiz-settings-ui" class="bg-background-dark hidden fixed top-0 left-0 w-full h-screen z-50">
    <div class="fixed inset-0 pointer-events-none overflow-hidden pixel-bg-pattern opacity-15"></div>
    <div class="absolute inset-0 bg-black/80 backdrop-blur-sm"></div>

    <div class="relative z-10 flex h-screen w-full items-center justify-center p-4">
      <!-- Container: Removed overflow-hidden to allow dropdowns to pop out. Added explicit rounded corners to children. -->
      <div
        class="w-full max-w-2xl bg-[#1a1a20] border-2 border-primary shadow-[0_0_30px_rgba(0,255,85,0.15)] flex flex-col relative rounded-3xl">

        <!-- Header: rounded-t-3xl -->
        <div
          class="bg-black/40 p-5 border-b border-white/10 flex items-center justify-between shrink-0 relative rounded-t-[calc(1.5rem-2px)]">
          <!-- Back Button -->
          <button id="settings-back-btn"
            class="flex items-center gap-3 text-white/50 hover:text-white transition-colors group">
            <div
              class="w-10 h-10 rounded-full border-2 border-white/10 flex items-center justify-center group-hover:border-primary group-hover:bg-primary group-hover:text-black transition-all">
              <span class="material-symbols-outlined font-bold">arrow_back</span>
            </div>
            <span
              class="text-xs font-bold uppercase tracking-widest hidden md:block group-hover:text-primary transition-colors">Back</span>
          </button>

          <h2 id="settings-quiz-title"
            class="flex-1 text-center text-xl md:text-2xl font-bold text-primary uppercase tracking-widest font-['Press_Start_2P'] leading-relaxed px-4 break-words">
            Quiz Title
          </h2>
          <!-- Empty div for spacing balance -->
          <div class="w-20 hidden md:block"></div>
        </div>

        <!-- Content Area: Tighter padding (p-6), tighter gap (gap-6) -->
        <div class="p-6 space-y-6 overflow-visible flex flex-col justify-center">

          <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6 relative z-30">

            <!-- ROW 1: Difficulty & Timer -->

            <!-- Difficulty -->
            <div class="space-y-2 relative z-[60]">
              <label
                class="flex items-center gap-2 text-white/50 text-[10px] font-bold uppercase tracking-widest font-['Press_Start_2P']">
                <span class="material-symbols-outlined text-sm text-primary">hotel_class</span> Kesulitan
              </label>

              <div class="relative w-full">
                <button id="settings-difficulty-trigger"
                  class="w-full h-12 bg-black/40 border-2 border-white/10 rounded-xl flex items-center justify-between px-4 text-white font-bold hover:border-primary transition-all group relative z-10">
                  <span id="settings-difficulty-selected" class="font-['Space_Grotesk'] tracking-wide">Mudah</span>
                  <span id="settings-difficulty-arrow"
                    class="material-symbols-outlined text-white/30 transition-transform duration-300 group-hover:text-primary">expand_more</span>
                </button>

                <div id="settings-difficulty-menu"
                  class="hidden absolute top-[calc(100%+8px)] left-0 w-full bg-[#1a1a20] border-2 border-primary/30 rounded-xl shadow-[0_0_30px_rgba(0,255,85,0.2)] overflow-hidden transform transition-all duration-200 origin-top z-[70] flex flex-col p-1">
                  <button
                    class="diff-opt w-full text-left px-4 py-3 hover:bg-white/10 hover:text-primary rounded-lg transition-colors text-white/70 font-bold font-['Space_Grotesk']"
                    data-value="mudah" data-label="Mudah">Mudah</button>
                  <button
                    class="diff-opt w-full text-left px-4 py-3 hover:bg-white/10 hover:text-primary rounded-lg transition-colors text-white/70 font-bold font-['Space_Grotesk']"
                    data-value="sedang" data-label="Sedang">Sedang</button>
                  <button
                    class="diff-opt w-full text-left px-4 py-3 hover:bg-white/10 hover:text-primary rounded-lg transition-colors text-white/70 font-bold font-['Space_Grotesk']"
                    data-value="sulit" data-label="Sulit">Sulit</button>
                </div>
              </div>
            </div>

            <!-- Timer -->
            <div class="space-y-2 relative z-[50]">
              <label
                class="flex items-center gap-2 text-white/50 text-[10px] font-bold uppercase tracking-widest font-['Press_Start_2P']">
                <span class="material-symbols-outlined text-sm text-primary">timer</span> Waktu
              </label>

              <div class="relative w-full">
                <button id="settings-timer-trigger"
                  class="w-full h-12 bg-black/40 border-2 border-white/10 rounded-xl flex items-center justify-between px-4 text-white font-bold hover:border-primary transition-all group relative z-10">
                  <span id="settings-timer-selected" class="font-['Space_Grotesk'] tracking-wide">5 Menit</span>
                  <span id="settings-timer-arrow"
                    class="material-symbols-outlined text-white/30 transition-transform duration-300 group-hover:text-primary">expand_more</span>
                </button>

                <div id="settings-timer-menu"
                  class="hidden absolute top-[calc(100%+8px)] left-0 w-full bg-[#1a1a20] border-2 border-primary/30 rounded-xl shadow-[0_0_30px_rgba(0,255,85,0.2)] overflow-hidden transform transition-all duration-200 origin-top z-[60] flex flex-col p-1">
                  <button
                    class="timer-opt w-full text-left px-4 py-3 hover:bg-white/10 hover:text-primary rounded-lg transition-colors text-white/70 font-bold font-['Space_Grotesk']"
                    data-value="300" data-label="5 Menit">5 Menit</button>
                  <button
                    class="timer-opt w-full text-left px-4 py-3 hover:bg-white/10 hover:text-primary rounded-lg transition-colors text-white/70 font-bold font-['Space_Grotesk']"
                    data-value="600" data-label="10 Menit">10 Menit</button>
                  <button
                    class="timer-opt w-full text-left px-4 py-3 hover:bg-white/10 hover:text-primary rounded-lg transition-colors text-white/70 font-bold font-['Space_Grotesk']"
                    data-value="900" data-label="15 Menit">15 Menit</button>
                </div>
              </div>
            </div>

            <!-- ROW 2: Question & Sound -->

            <!-- Question Count -->
            <div class="space-y-2 relative z-[40]">
              <label
                class="flex items-center gap-2 text-white/50 text-[10px] font-bold uppercase tracking-widest font-['Press_Start_2P']">
                <span class="material-symbols-outlined text-sm text-primary">numbers</span> Jumlah Soal
              </label>

              <div class="relative w-full">
                <button id="settings-question-trigger"
                  class="w-full h-12 bg-black/40 border-2 border-white/10 rounded-xl flex items-center justify-between px-4 text-white font-bold hover:border-primary transition-all group relative z-10">
                  <span id="settings-question-selected" class="font-['Space_Grotesk'] tracking-wide">5 Soal</span>
                  <span id="settings-question-arrow"
                    class="material-symbols-outlined text-white/30 transition-transform duration-300 group-hover:text-primary">expand_more</span>
                </button>

                <div id="settings-question-menu"
                  class="hidden absolute top-[calc(100%+8px)] left-0 w-full bg-[#1a1a20] border-2 border-primary/30 rounded-xl shadow-[0_0_30px_rgba(0,255,85,0.2)] overflow-hidden transform transition-all duration-200 origin-top z-[60] flex flex-col p-1">
                  <button
                    class="question-opt w-full text-left px-4 py-3 hover:bg-white/10 hover:text-primary rounded-lg transition-colors text-white/70 font-bold font-['Space_Grotesk']"
                    data-value="5" data-label="5 Soal">5 Soal</button>
                  <button
                    class="question-opt w-full text-left px-4 py-3 hover:bg-white/10 hover:text-primary rounded-lg transition-colors text-white/70 font-bold font-['Space_Grotesk']"
                    data-value="10" data-label="10 Soal">10 Soal</button>
                  <button
                    class="question-opt w-full text-left px-4 py-3 hover:bg-white/10 hover:text-primary rounded-lg transition-colors text-white/70 font-bold font-['Space_Grotesk']"
                    data-value="15" data-label="15 Soal">15 Soal</button>
                </div>
              </div>
            </div>

            <!-- Sound Toggle -->
            <div class="space-y-2 relative z-[30]">
              <label
                class="flex items-center gap-2 text-white/50 text-[10px] font-bold uppercase tracking-widest font-['Press_Start_2P']">
                <span class="material-symbols-outlined text-sm text-primary">music_note</span> Music
              </label>

              <div
                class="w-full h-12 flex items-center bg-black/40 border-2 border-white/10 rounded-xl px-4 justify-between group hover:border-primary transition-colors cursor-pointer"
                onclick="document.getElementById('sound-toggle-btn').click()">
                <span class="text-white font-bold font-['Space_Grotesk'] tracking-wide">Music</span>

                <button id="sound-toggle-btn"
                  class="w-12 h-7 bg-[#34c759] rounded-full relative transition-colors duration-300 cursor-pointer shadow-inner shrink-0">
                  <div id="sound-toggle-knob"
                    class="absolute top-[2px] left-[2px] w-6 h-6 bg-white rounded-full shadow-md transform translate-x-6 transition-transform duration-300">
                  </div>
                </button>
              </div>
            </div>

          </div>
        </div>

        <!-- Footer: rounded-b-3xl -->
        <div class="p-5 bg-black/40 border-t border-white/10 flex justify-center mt-auto rounded-b-[calc(1.5rem-2px)]">
          <button id="settings-continue-btn"
            class="w-full md:w-auto px-12 h-14 bg-primary text-black font-bold text-sm uppercase rounded-xl hover:bg-primary/90 hover:scale-[1.02] active:scale-[0.98] transition-all font-['Press_Start_2P'] flex items-center justify-center gap-3 shadow-[0_0_20px_rgba(0,255,85,0.3)]">
            BUAT ROOM
          </button>
        </div>

      </div>
    </div>
  </div>

  <!-- WAITING ROOM OVERLAY (Refined V3) -->
  <div id="waiting-ui"
    class="bg-background-dark hidden fixed top-0 left-0 w-full h-screen z-20 overflow-hidden font-display">
    <div class="fixed inset-0 pointer-events-none overflow-hidden pixel-bg-pattern opacity-15"></div>

    <div class="relative z-10 flex h-screen w-full flex-col p-6">

      <!-- Back Button (Matched Style) -->
      <!-- Back Button (Matched Style) -->
      <button id="waiting-back-btn"
        class="absolute top-6 left-6 w-12 h-12 bg-black/40 border-2 border-white/10 hover:border-primary rounded-full flex items-center justify-center transition-all z-50 group shadow-lg">
        <span class="material-symbols-outlined text-white/50 group-hover:text-white transition-colors">arrow_back</span>
      </button>

      <main class="flex-1 flex gap-6 overflow-hidden max-w-[1600px] mx-auto w-full pt-12">
        <!-- LEFT: Character & Profile - Adjusted Width -->
        <section class="w-96 shrink-0 flex flex-col gap-3">
          <div id="sidebar-card"
            class="bg-surface-dark border-4 border-black p-5 rounded-2xl flex flex-col gap-4 shadow-xl relative overflow-hidden">

            <!-- 1. Character Selection -->
            <div id="character-selection-section" class="space-y-2 shrink-0 w-full">
              <p class="text-[10px] font-bold text-white/40 uppercase tracking-widest text-center">Selected Character
              </p>

              <div class="flex items-center gap-2">
                <button
                  class="w-8 h-8 bg-black/40 border-2 border-white/10 hover:border-primary flex items-center justify-center transition-colors rounded-lg">
                  <span class="material-symbols-outlined text-white/50">chevron_left</span>
                </button>

                <!-- Preview Box - Height Reduced further (160px) to save space for QR -->
                <div id="character-preview-box"
                  class="flex-1 h-40 bg-black/40 border-2 border-white/10 rounded-xl flex items-center justify-center relative overflow-hidden group hover:border-primary transition-colors cursor-pointer ring-1 ring-white/5 shadow-inner">
                  <div class="absolute inset-0 bg-[url('/assets/bg_pattern.png')] opacity-20"></div>
                </div>

                <button
                  class="w-8 h-8 bg-black/40 border-2 border-white/10 hover:border-primary flex items-center justify-center transition-colors rounded-lg">
                  <span class="material-symbols-outlined text-white/50">chevron_right</span>
                </button>
              </div>
            </div>

            <!-- 2. Name Input -->
            <div id="player-name-section" class="space-y-1 shrink-0">
              <p class="text-[9px] font-bold text-white/40 uppercase tracking-widest text-center">Your Name</p>
              <input id="player-name-input"
                class="w-full h-12 bg-black/60 border-2 border-white/10 focus:border-primary focus:ring-0 px-4 font-bold tracking-widest uppercase text-white text-sm placeholder:text-white/20 font-['Press_Start_2P'] text-center rounded-xl transition-all"
                placeholder="PLAYER" type="text" maxlength="12" />
            </div>

            <!-- 3. Room Code (Centered) -->
            <!-- 3. Room Code (Absolute Copy Icon) -->
            <div
              class="shrink-0 relative bg-black/40 border-2 border-primary/50 p-5 rounded-xl flex flex-col items-center justify-center gap-1 group hover:border-primary transition-colors">
              <span id="display-room-code"
                class="text-3xl font-bold tracking-[0.2em] text-primary font-['Press_Start_2P'] drop-shadow-md text-center">------</span>

              <button id="copy-code-btn"
                class="absolute top-2 right-2 p-1.5 text-white/20 hover:text-white hover:bg-white/10 rounded-lg transition-all"
                title="Copy Code">
                <span id="copy-icon" class="material-symbols-outlined text-sm">content_copy</span>
              </button>
            </div>

            <!-- 4. QR Code (Aligned & Tight Style) -->
            <div class="mt-0.5 flex flex-col items-center w-full">
              <div
                class="bg-black/40 p-4 rounded-xl w-full flex items-center justify-center border-2 border-primary shadow-[0_0_15px_rgba(0,255,85,0.1)]">
                <div class="w-48 h-48 bg-white p-2 rounded-lg">
                  <img src="" class="w-full h-full object-contain mix-blend-multiply" alt="QR" id="room-qr-code" />
                </div>
              </div>
            </div>

            <!-- 5. Host-only Start Button Container -->
            <div id="host-start-btn-container" class="mt-2 w-full hidden">
              <!-- Re-injected here via JS for host -->
            </div>
          </div>
        </section>

        <!-- CENTER: Connected Players -->
        <section class="flex-1 flex flex-col gap-4 min-w-0">
          <div
            class="bg-surface-dark border-4 border-black p-6 rounded-2xl flex-1 flex flex-col relative overflow-hidden shadow-xl">
            <div class="flex justify-between items-center mb-6 border-b-2 border-white/5 pb-4">
              <!-- Header Font Fix -->
              <h3 id="waiting-header-text"
                class="text-sm font-bold text-white uppercase tracking-widest flex items-center gap-3 font-['Press_Start_2P']">
                <span class="flex size-3 relative">
                  <span
                    class="animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"></span>
                  <span class="relative inline-flex rounded-full size-3 bg-primary"></span>
                </span>
                Connected Players
              </h3>
              <div id="player-count"
                class="px-3 py-1 bg-primary/20 text-primary border border-primary/30 rounded text-[10px] font-bold font-['Press_Start_2P']">
                0/4</div>
            </div>

            <!-- Grid: Tall Cards -->
            <div id="player-grid" class="grid grid-cols-4 gap-4 flex-1 h-full max-h-[400px]">
              <!-- Content injected via JS -->
            </div>
          </div>

          <!-- Start Button Area -->
          <div class="shrink-0 relative">
            <button id="start-game-btn"
              class="w-full py-6 bg-primary text-background-dark font-bold text-xl uppercase pixel-btn-green border-4 border-black active:translate-y-1 transition-transform hidden font-['Press_Start_2P'] shadow-[0_10px_0_#000] hover:brightness-110 mb-2">
              START GAME
            </button>
            <div id="waiting-msg"
              class="w-full py-6 flex items-center justify-center bg-black/20 border-4 border-black/20 rounded-xl">
              <p
                class="text-white/30 text-xs font-bold uppercase tracking-widest animate-pulse font-['Press_Start_2P']">
                Waiting for host...</p>
            </div>
          </div>
        </section>

        <!-- RIGHT: Room Selection REMOVED -->
        <!-- The center column now flex-expands to fill this space -->
      </main>
    </div>
  </div>

  <!-- GLOBAL TRANSITION OVERLAY -->
  <div id="transition-overlay"></div>

  <!-- MAIN SCRIPT -->
  <script type="module" src="/src/main.ts"></script>
</body>

</html>